services:
  # ----------------------- FastAPI backend -----------------------
  - type: web
    runtime: python
    name: rag-api
    plan: free
    buildCommand: pip install -r requirements.txt
    startCommand: uvicorn src.app.main:app --host 0.0.0.0 --port $PORT
    envVars:
      - key: PYTHON_VERSION
        value: "3.11.9"          # full semver required
      - key: GOOGLE_API_KEY
        value: "AIzaSyDtoNMQE8YGyZG55U7a1E_-OL_LJ7Foscs"           # you'll paste the real key in the Render UI
      - key: GEMINI_MODEL
        value: "gemini-2.5-flash"   # use a model you know your account supports
      - key: EMBEDDINGS_MODEL
        value: "models/text-embedding-004"
      - key: PYTHONPATH
        value: "."               # so 'src' is importable

  # ----------------------- Streamlit frontend --------------------
  - type: web
    runtime: python
    name: rag-ui
    plan: free
    buildCommand: pip install -r requirements.txt
    startCommand: streamlit run streamlit_app/stream.py --server.port $PORT --server.address 0.0.0.0
    envVars:
      - key: PYTHON_VERSION
        value: "3.11.9"
      - key: API_URL
        value: "https://<rag-api>.onrender.com/chat"                # leave blank now; set to https://<rag-api>/chat AFTER api is live
      - key: PYTHONPATH
        value: "."
